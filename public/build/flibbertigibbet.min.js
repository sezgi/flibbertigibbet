var FacebookButton=React.createClass({displayName:"FacebookButton",handleClick:function(){this.props.onSessionChange()},render:function(){var a=this.props.loggedIn?React.DOM.a({className:"logout-link",href:"javascript://",onClick:this.handleClick},"Log out"):React.DOM.a({className:"login-button button-link",href:"javascript://",onClick:this.handleClick},"Log in with Facebook");return React.DOM.div(null,a)}}),LocationSelector=React.createClass({displayName:"LocationSelector",getInitialState:function(){return{cityResults:[],showCityResults:!0,venueResults:[],showVenueResults:!0,selectedCity:""}},handleCitySearch:function(a){var b=$(a.target),c=b.val();c||this.setState({showCityResults:!1}),this.setState({selectedCity:c}),$.ajax({url:"https://api.foursquare.com/v2/geo/geocode",data:{client_id:see.config.FOURSQUARE_CLIENT_ID,client_secret:see.config.FOURSQUARE_CLIENT_SECRET,v:"20140828",query:c,autocomplete:!0},success:_.bind(function(a){var b=[];_.each(a.response.geocode.interpretations.items,function(a){b.push(a.feature.displayName)}),this.setState({cityResults:b}),this.setState({showCityResults:!0})},this),error:_.bind(function(){this.setState({cityResults:[]}),this.setState({showCityResults:!1})},this)})},handleCityClick:function(a){this.setState({selectedCity:a}),this.setState({showCityResults:!1})},handleVenueSearch:function(a){var b=$(a.target),c=b.val(),d=$(".citySelector");return this.setState({selectedVenue:c}),c?void $.ajax({url:"https://api.foursquare.com/v2/venues/explore",data:{client_id:see.config.FOURSQUARE_CLIENT_ID,client_secret:see.config.FOURSQUARE_CLIENT_SECRET,v:see.config.FOURSQUARE_VERSION,near:d.val(),query:c,venuePhotos:!0},success:_.bind(function(a){var b=[];_.each(a.response.groups[0].items,function(a){b.push(a.venue.name)}),this.setState({venueResults:b}),this.setState({showVenueResults:!0})},this),error:_.bind(function(){this.setState({venueResults:[]}),this.setState({showVenueResults:!1})},this)}):void this.setState({showVenueResults:!1})},handleVenueClick:function(a){this.setState({selectedVenue:a}),this.setState({showVenueResults:!1})},render:function(){return React.DOM.div({className:"location-selector"},LocationInput({handleCitySearch:this.handleCitySearch,handleVenueSearch:this.handleVenueSearch,selectedCity:this.state.selectedCity,selectedVenue:this.state.selectedVenue}),this.state.showCityResults?CityResults({results:this.state.cityResults,handleCityClick:this.handleCityClick}):null,this.state.showVenueResults?VenueResults({results:this.state.venueResults,handleVenueClick:this.handleVenueClick}):null)}}),LocationInput=React.createClass({displayName:"LocationInput",handleCitySearch:function(a){this.props.handleCitySearch(a)},handleVenueSearch:function(a){this.props.handleVenueSearch(a)},render:function(){return React.DOM.form(null,React.DOM.input({className:"citySelector",type:"text",placeholder:"Type to select a city...",value:this.props.selectedCity,onChange:this.handleCitySearch}),React.DOM.input({className:"venueSelector",type:"text",placeholder:"Type to select a venue...",value:this.props.selectedVenue,onChange:this.handleVenueSearch}))}}),CityResults=React.createClass({displayName:"CityResults",handleClick:function(a){var b=$(a.target);this.props.handleCityClick(b.text())},render:function(){var a=[];return _.each(this.props.results,function(b){a.push(React.DOM.li({className:"search-result"},b))}),React.DOM.ul({onClick:this.handleClick},a)}}),VenueResults=React.createClass({displayName:"VenueResults",handleClick:function(a){var b=$(a.target);this.props.handleVenueClick(b.text())},render:function(){var a=[];return _.each(this.props.results,function(b){a.push(React.DOM.li({className:"search-result"},b))}),React.DOM.ul({onClick:this.handleClick},a)}}),Main=React.createClass({displayName:"Main",getInitialState:function(){return{loggedIn:this.props.currentUser}},handleSessionChange:function(){this.state.loggedIn?(Parse.User.logOut(),this.setState({loggedIn:!1})):Parse.FacebookUtils.logIn("publish_actions,email",{success:function(a){a.existed()||this.createUser(a)},error:function(){console.log("User cancelled the Facebook login or did not fully authorize.")}}).then(_.bind(function(){this.setState({loggedIn:!0})},this))},createUser:function(a){var b=a.attributes.authData.facebook.access_token;$.ajax({url:"https://graph.facebook.com/v2.0/me",data:{access_token:b},success:function(b){_.each(_.keys(b),function(c){"id"!=c&&a.set(c,b[c])}),a.save()},error:function(a,b){console.log(b)}})},render:function(){return React.DOM.div({className:"wrapper"},FacebookButton({loggedIn:this.state.loggedIn,onSessionChange:this.handleSessionChange}),LocationSelector(null))}});React.renderComponent(Main({currentUser:Parse.User.current()}),$("#main")[0]);
//# sourceMappingURL=flibbertigibbet.map